version: 2
jobs:
 build:
   machine: true
   steps:
     - checkout
     - run: docker build -t meteosatstation/ingestion:$CIRCLE_BRANCH .
 publish:
   machine: true
   steps:
     - run:
         name: Publish Docker Image to Docker Hub
         command: |
           echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
           docker push $IMAGE_NAME:latest

workflows:
  version: 2
  build_and_test:
    jobs:
      - build
  build-master:
    jobs:
      - build:
          filters:
            branches:
              only: master
      - publish:
          requires:
            - build
          filters:
            branches:
              only: master